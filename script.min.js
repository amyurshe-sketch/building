document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("themeToggle"),t=e.querySelector("i"),n=document.body,o=document.getElementById("langToggle");let l=n.getAttribute("lang")||"ru",c=document.getElementById("navToggle"),d=document.getElementById("mainNav");"dark"===localStorage.getItem("theme")&&(n.classList.remove("theme-light"),n.classList.add("theme-dark"),t.classList.remove("fa-moon"),t.classList.add("fa-sun")),"en"===localStorage.getItem("lang")&&setLang("en"),e.addEventListener("click",(()=>{n.classList.toggle("theme-dark"),n.classList.toggle("theme-light"),n.classList.contains("theme-dark")?(t.classList.remove("fa-moon"),t.classList.add("fa-sun"),localStorage.setItem("theme","dark")):(t.classList.remove("fa-sun"),t.classList.add("fa-moon"),localStorage.setItem("theme","light"))})),o.addEventListener("click",(()=>{l="ru"===l?"en":"ru",setLang(l),localStorage.setItem("lang",l)})),c.addEventListener("click",(()=>{c.classList.toggle("active"),d.classList.toggle("active"),n.style.overflow=d.classList.contains("active")?"hidden":""})),document.querySelectorAll("nav a").forEach((e=>{e.addEventListener("click",(()=>{c.classList.remove("active"),d.classList.remove("active"),n.style.overflow=""}))})),document.addEventListener("click",(e=>{d.contains(e.target)||c.contains(e.target)||!d.classList.contains("active")||(c.classList.remove("active"),d.classList.remove("active"),n.style.overflow="")})),window.addEventListener("orientationchange",(()=>{window.innerWidth>768&&(c.classList.remove("active"),d.classList.remove("active"),n.style.overflow="")}));function setLang(e){document.body.setAttribute("lang",e),document.querySelectorAll(".lang-ru").forEach((t=>{t.style.display="ru"===e?"":"none"})),document.querySelectorAll(".lang-en").forEach((t=>{t.style.display="en"===e?"":"none"})),c.setAttribute("aria-label","ru"===e?"Меню":"Menu")}const a=document.getElementById("contactForm"),i=document.getElementById("formMessage");a.addEventListener("submit",(async e=>{e.preventDefault();const t=a.elements.name.value.trim(),o=a.elements.phone.value.trim(),c=a.elements.message.value.trim();if(!t||!o||!c)return void showMessage("ru"===l?"Пожалуйста, заполните все поля":"Please fill in all fields","error");const d=a.querySelector('button[type="submit"]'),r=d.textContent;d.textContent="ru"===l?"Отправка...":"Sending...",d.disabled=!0;try{const e=getPageMetadata();await sendToTelegram({name:t,phone:o,message:c,website:e.website,title:e.title,description:e.description,url:e.url,language:l,timestamp:new Date().toLocaleString("ru-RU")}),a.reset(),showMessage("ru"===l?"Спасибо! Ваша заявка отправлена.":"Thank you! Your request has been sent.","success")}catch(e){console.error("Ошибка отправки:",e),showMessage("ru"===l?"Ошибка отправки. Попробуйте позже.":"Sending failed. Please try again later.","error")}finally{d.textContent=r,d.disabled=!1}}));function getPageMetadata(){const e=document.title||"GreenBuild — Загородное строительство и ландшафт",t=document.querySelector('meta[name="description"]')?.content||"Превращаем ваши идеи в успешные веб-проекты. Индивидуальный подход, прозрачные сроки и гарантия качества.",n=window.location.href,o="GreenBuild";return{title:e,description:t,url:n,website:o}}function showMessage(e,t){i.textContent=e,i.style.color="success"===t?"#3a7d3a":"#d9534f",i.style.backgroundColor="success"===t?"rgba(58,125,58,0.1)":"rgba(217,83,79,0.1)",setTimeout((()=>{i.textContent="",i.style.backgroundColor=""}),5e3)}async function sendToTelegram(e){const t=await fetch("/api/telegram",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){const e=await t.json().catch((()=>({})));throw new Error(e.error||`HTTP error! status: ${t.status}`)}return await t.json()}document.querySelectorAll('a[href^="#"]').forEach((e=>{e.addEventListener("click",(function(e){e.preventDefault();const t=document.querySelector(this.getAttribute("href"));if(t){const e=document.querySelector("header").offsetHeight,o=t.getBoundingClientRect().top+window.pageYOffset-e;window.scrollTo({top:o,behavior:"smooth"})}}))})),"IntersectionObserver"in window&&(new IntersectionObserver(((e,t)=>{e.forEach((e=>{if(e.isIntersecting){const n=e.target;n.src=n.dataset.src,n.classList.remove("lazy"),t.unobserve(n)}}))})).observe(document.querySelectorAll("img[data-src]")));let r=0;document.addEventListener("touchstart",(e=>{r=e.touches[0].clientY}),{passive:!0}),document.addEventListener("touchmove",(e=>{d.classList.contains("active")&&e.preventDefault()}),{passive:!1});let s;window.addEventListener("resize",(()=>{clearTimeout(s),s=setTimeout((()=>{window.innerWidth>768&&(c.classList.remove("active"),d.classList.remove("active"),n.style.overflow="")}),250)})),document.addEventListener("keydown",(e=>{"Escape"===e.key&&(c.classList.remove("active"),d.classList.remove("active"),n.style.overflow="")}));function u(){["https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=800&q=80","https://images.unsplash.com/photo-1464983953574-0892a716854b?auto=format&fit=crop&w=600&q=80"].forEach((e=>{const t=document.createElement("link");t.rel="preload",t.as="image",t.href=e,document.head.appendChild(t)}))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",u):u()})),window.IntersectionObserver||console.warn("IntersectionObserver не поддерживается, lazy loading отключен");
